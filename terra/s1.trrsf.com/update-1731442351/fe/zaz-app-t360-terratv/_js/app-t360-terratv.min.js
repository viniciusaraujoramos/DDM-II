/*! zaz-app-t360-terratv - v1.0.0 - 24/04/2024 -- 1:14pm */

zaz.use(function(pkg){"use strict";var console=pkg.console,dictFactory;pkg.factoryManager.get("dict").create({name:"t360Terratv",version:"1.0.0",state:"ok",extends:[],langs:{global:{termWithPlural:["plural","singular"],url:"http://terratv.terra.com.br/"},pt:{assistindo:"assistindo","assistindo %WATCHED% de %TOTAL% videos":"Assistindo %WATCHED% de %TOTAL% videos",assistir:"assistir","mais sobre":"TODOS OS <b>VIDEOS</b>"},es:{assistindo:"exhibiéndose","assistindo %WATCHED% de %TOTAL% videos":"Exhibiéndose %WATCHED% de %TOTAL% videos",assistir:"ver","mais sobre":"TODOS LOS <b>VIDEOS</b>"},en:{assistindo:"now playing","assistindo %WATCHED% de %TOTAL% videos":"Now playing %WATCHED% of %TOTAL% videos",assistir:"watch","mais sobre":"ALL <b>VIDEOS</b>"},"es-AR":{url:"http://terratv.terra.com.ar/"},"es-CL":{url:"http://terratv.terra.cl/"},"es-MX":{url:"http://terratv.terra.com.mx/"},"es-ES":{url:"http://www.terra.tv/"},"es-CO":{url:"http://terratv.terra.com.co/"},"es-PE":{url:"http://terratv.terra.com.pe/"},"es-US":{url:"http://terratv.terra.com/"}}})}),zaz.use(function appTerratv(pkg){"use strict";var console=pkg.console,require=pkg.require,define=pkg.define,appFactory=pkg.factoryManager.get("app"),PUBLIC_STATIC=null,STATIC={},deviceType=pkg.context.platform.get("type");appFactory.create({name:"t360.terratv",version:"1.0.0",state:"ok",docs:"http://github.tpn.terra.com/pages/terra/terratv",source:"http://github.tpn.terra.com/Terra/terratv",description:"app de videos na capa",tests:"http://s1.trrsf.com/fe/terratv/tests/index.htm?zaz[env]=tests",dependencies:[],dictionaries:["t360Terratv"],templates:{default:'<div class="table-news zaz-app-terratv__background" data-type="TABLE-APP" color-scheme="dark" data-position="{{ tableInfo.tableSequence }}" data-area="TERRATV" id="table-{{ card.id }}" data-id="{{ card.id }}" data-app-name="{{ card.name }}" data-render-type="backend" data-type-ad="STICK" data-area-ad="terratv"><div class="zaz-app-terratv table-range-flex">{% set isHome = context[\'isHome\'] %}{% set isVideo = context[\'isVideo\'] %}{% if context[\'isHome\'] == \'False\' %}{% set isHome = False %}{% endif %}{% if context[\'isVideo\'] == \'False\' %}{% set isVideo = False %}{% endif %}{% if (isHome and not isVideo) or (not isHome and isVideo) or (not isHome and not isVideo)%}<a href="http://www.terra.com.br/videos" class="zaz-app-terratv__logo">Principais Vídeos</a>{% endif %}<div class="zaz-app-terratv__wrapper"><div class="zaz-app-terratv__left-half">{% set video = card[\'items\'][0][\'items\'][0] %}{% set videoChannel = video|get_main_channel %}<div class="zaz-app-terratv__player">{% if context[\'device\'] == \'mob\' and video.image.url != None %}<div class="zaz-app-terratv__thumb-main-video"><a href="{{video.url}}"><span class="icon-solid icon-32 icon-play"></span><div class="zaz-app-terratv__thumb-main-video--shadow"></div><img alt="{{ video.title }}" src="https://p2.trrsf.com/image/fget/cf/300/170/{{video.image.url.replace(\'http://\',\'\')}}"></a></div>{% endif %}</div><div class="zaz-app-terratv__left-half__video-data"><div class="zaz-app-terratv__playing"><div class="zaz-app-terratv__playing__header"><div class="zaz-app-terratv__playing__title"><a href="{{ video.url }}">{{ video.fullTitle }}</a></div></div></div></div></div><div class="zaz-app-terratv__right-half"><div class="zaz-app-terratv__concat-scroller-list"><ul class="zaz-app-terratv__list">{% if context[\'device\'] == \'mob\' %}{% set video_list = card[\'items\'][0:3] %}{% else %}{% set video_list = card[\'items\'][0:5] %}{% endif %}{% for item in video_list %}{% set channelColor = item|get_channel_color %}{% set video = item[\'items\'][0] %}<li class="zaz-app-terratv__list__item"><a class="zaz-app-terratv__list__link" data-id="{{video.id}}" href="{{video.socialURL}}" target="_top" title="{{ video.fullTitle | escape }}"><div class="zaz-app-terratv__list__item__thumb" data-text="assistindo" ><div class="zaz-app-terratv__list__item__watchingOverlay">ASSISTINDO</div>{% if video.image.url != null and video.image.url != "" %}<img class="zaz-app-terratv__list__item__img" alt="{{ video.title | escape }}" src="https://p2.trrsf.com/image/fget/cf/242/136/{{video.image.url.replace(\'http://\',\'\')}}">{% endif %}</div><div class="zaz-app-terratv__list__item__info">{% if video.channels != None and video.channels[0] %}<div class="zaz-app-terratv__channel color-{{channelColor}}">{{video.channels[0].label}}</div>{% endif %}<span class="zaz-app-terratv__list__item__title">{{ video.fullTitle }}</span></div></a></li>{% endfor %}{% if context[\'isVideo\'] != \'true\' %}<div class="zaz-app-terratv__see-more-btn"><a class="zaz-app-terratv__see-more-btn__link" href="{{context.channel_url}}videos"><span class="zaz-app-terratv__see-more-btn__text">Acessar todos os vídeos</span></a></div>{% endif %}</ul></div>{% set card_info = {"type" : "rect", "id" : "ad-table-" + card.id + \'-1\', \'area_ad\': \'terratv\', "placeholder" : True} %}{% include \'zaz-app-t360-cards/_templates/card-ad.html\' %}</div></div></div></div>'},expects:{},setup:function(__static,__proto,__shared){},init:function(data,__shared){function _getClassChannel(channelItem){var borderClass="-default";if(channelItem)for(var channelNames={pt:["noticias","economia","esportes","diversao","vida-e-estilo","musica"],es:["noticias","economia","deportes","entretenimiento","vida-y-estilo","musica"],en:["news","economy","sports","entertainment","life-style","musica"],className:["-news","-economy","-sport","-entertainment","-live-style","-entertainment"]},objDict=channelNames[pkg.context.page.get("lang")],x=0;x<objDict.length;x++)if(0<=channelItem.url.search(objDict[x]))return channelNames.className[x];return"-default"}data.renderType="default",data.container&&(data.target=data.container,data.data.renderType&&(data.renderType=data.data.renderType),data.data.playerAppName&&(data.playerAppName=data.data.playerAppName),data.data=data.data.items);var PUBLIC=this,PRIVATE={},API={},player={},playing={},autoplay=!1;if(PRIVATE.playerAppName="app.player","app.thirdPlayer"==data.playerAppName&&(PRIVATE.playerAppName="app.thirdPlayer"),"continuos-play"===data.renderType&&(autoplay=!0),PRIVATE.clicked=!0,location.hash&&-1<location.hash.search("cp")&&(PRIVATE.clicked=!1),pkg.utils.make.observable(playing),PRIVATE._extend=function(){for(var obj=arguments[0],obj2,i=1;arguments.length>i;i++)for(var j in obj2=arguments[i])obj2.hasOwnProperty(j)&&(obj[j]=obj2[j]);return obj},PRIVATE._getIdVideo=function(element){var id;return element.htmlDataset("id")?id=element.htmlDataset("id"):(!(id=element.id.match(/\d+$/)||element.href&&element.href.match(/\d+$/))&&element.href.match(/.*(\d{7})\.html$/)&&(id=element.href.match(/.*(\d{7})\.html$/)[1]),!id&&element.href.match(/.*(\d{6})\.html$/)&&(id=element.href.match(/.*(\d{6})\.html$/)[1])),id},(data=PRIVATE._extend({player:".zaz-app-terratv__player",list:".zaz-app-terratv__list",wrap:".zaz-app-terratv__list__wrap",scroller:".zaz-app-terratv__list__scroller",commandsScroller:".zaz-app-terratv__scroller__buttons",item:".zaz-app-terratv__list__item",anchor:".zaz-app-terratv__list__link",counter:".zaz-app-terratv__scroller__counter"},data)).target){if("backend"!=data.target.htmlDataset("renderType")){if(!data.data[0].items)for(var videoItems in data.data)data.data.hasOwnProperty(videoItems)&&(data.data[videoItems].items=[data.data[videoItems]]);data.target.innerHTML=PUBLIC.templates.get("default").render({items:data.data,renderType:data.renderType,dict:PUBLIC.l10n,toHHMMSS:function(minutes){var seconds=parseInt(minutes,10),hours=Math.floor(seconds/3600),minutes=Math.floor((seconds-3600*hours)/60),seconds=seconds-3600*hours-60*minutes,hours;return minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),(hours=hours<10&&0<hours?"0"+hours+":":"")+minutes+":"+seconds},getclass:function(channels){if(channels&&0<channels.length){var channelItem=channels[0];if(1<channels.length)for(var i=0;i<channels.length;i++)if(channels[i].usedInURL){channelItem=channels[i];break}return _getClassChannel(channelItem)}}})}var playerW=375,playerH=211,tgmkeyGroup=pkg.context.page.get("tgmkey"),adConf={enabled:!0,tgmKey:tgmkeyGroup&&tgmkeyGroup.video||""};"mob"!=deviceType&&(playerW=757,playerH=426,pkg.context.page.at("range",function(val){switch(val){case"xlarge":playerW=757,playerH=426;break;case"large":playerW=550,playerH=309;break;case"medium":default:playerW=636,playerH=359;break;case"small":playerW=375,playerH=211}player.obj?player.obj.resize(playerW,playerH):playing.set("anchor",playing.get("anchor")),PUBLIC.trigger("resize")})),player.target=data.target.querySelector(".zaz-app-terratv__player"),player.caption=data.target.querySelector(".zaz-app-terratv__playing__title"),player.channel=data.target.querySelector(".zaz-app-terratv__channel"),player.watchingXofYLabel=data.target.querySelector(".zaz-app-terratv__scroller__counter"),player.list="string"==typeof data.list?data.target.querySelector(data.list):data.list,player.items=Array.from(player.list.querySelectorAll(data.anchor)),player.metrics=function(index){window.tga.send("send","event","terratv","click","video-"+(index+1))},player._normalizeUvsystem=function(str){return str.replace(/((br|ar|cl|mx|es|co|pe))\.(.*)/,"$3")},player._loadVideo=function(objPlaceholder,id,metrics){metrics=!1!==metrics||metrics;var setupTransitionOptions={enabled:!0,continuousPlay:!1},metricsChannel,metricsSiteId,tgmKey;data.target.htmlDataset("renderBackend")?(metricsChannel=player.items[player.active].htmlDataset("channelMetricschannel"),metricsSiteId=player.items[player.active].htmlDataset("channelMetricssiteid"),tgmKey=player.items[player.active].htmlDataset("channelTgmkey"),adConf.tgmKey=tgmKey?tgmKey+".videos":""):(metricsChannel=data.data[player.active].items[0].channels[0].metricsChannel,metricsSiteId=data.data[player.active].items[0].channels[0].metricsSiteId);var objMetrics=PRIVATE._extend({infoChannel:window.terra_info_channel,infoChannel_detail:window.terra_info_channeldetail,idCertifica:window.terra_stats_idCrtfc},metrics?{infoChannel:metricsChannel,idCertifica:metricsSiteId}:{}),loadPlayer=function(){var objNextVideo=PRIVATE.getNextVideo(),regClickMetrics;PRIVATE.objPlayer=new PRIVATE.AppPlayer({videoId:id,container:objPlaceholder,advertise:adConf,clicked:PRIVATE.clicked,autoPlay:autoplay,isEmbedded:!1,context:!0===pkg.context.page.get("isHome")?"app-capa":"",metrics:objMetrics,nextVideoId:objNextVideo.id,onReady:function(playerObj){"default"===data.renderType?PRIVATE.loadNextVideo(playerObj):"continuos-play"===data.renderType&&PRIVATE.loadPageVideo(playerObj)}}),0===player.active&&(regClickMetrics=function(){player.metrics(0),PRIVATE.objPlayer.events.off("play",regClickMetrics)},PRIVATE.objPlayer.events.on("play",regClickMetrics)),PRIVATE.clicked=!1,autoplay=!0};PRIVATE.objPlayer?PRIVATE.objPlayer.destroy().then(function(){loadPlayer()}):loadPlayer()},PRIVATE.getNextVideo=function(){var nextAnchor,id=player.items.indexOf(playing.lastPlaying),nextAnchor=id<player.items.length-1?player.items[id+1]:player.items[0];return nextAnchor&&(id=PRIVATE._getIdVideo(nextAnchor)),{id:id,nextAnchor:nextAnchor}},PRIVATE.loadPageVideo=function(playerObj){var objNextVideo=PRIVATE.getNextVideo();player.obj=playerObj,objNextVideo.id&&(playerObj.api.setupTransition(PRIVATE.AppPlayer.CONTINUOUS_PLAY,objNextVideo.id),playerObj.events.on("nextVideo",function(data){data.type==PRIVATE.AppPlayer.RELATED_LIST?location.href=PRIVATE.AppPlayer.redirectVideo(data.videoId):objNextVideo.nextAnchor&&objNextVideo.nextAnchor.href&&(location.href=objNextVideo.nextAnchor.href+"#cp")}))},PRIVATE.loadNextVideo=function(playerObj){var objNextVideo=PRIVATE.getNextVideo();player.target&&(player.target.className=player.target.className.replace(" loading-app","")),player.obj=playerObj,objNextVideo.id&&(playerObj.api.setupTransition(PRIVATE.AppPlayer.CONTINUOUS_PLAY,objNextVideo.id),playerObj.events.on("nextVideo",function(data){data.type==PRIVATE.AppPlayer.RELATED_LIST?location.href=PRIVATE.AppPlayer.redirectVideo(data.videoId):objNextVideo.nextAnchor&&playing.set("anchor",objNextVideo.nextAnchor)}))},playing.on("channel",function(el){var tmp;player.channel&&(tmp=player.channel.parentElement,player.channel.parentElement.replaceChild(el.cloneNode(!0),player.channel),player.channel=tmp.querySelector("."+[].slice.call(el.getClassList()).join(".")))}),playing.on("caption",function(objCaption){player.caption&&(player.caption.innerHTML='<a href="'+objCaption.href+'">'+objCaption.title+"</a>")}),playing.on("id",function(value){player._loadVideo(player.target,value)}),playing.on("anchor",function(value){return player.active=player.items.indexOf(value),0!==player.active&&player.metrics(player.active),"continuos-play"===data.renderType&&player.obj?(PRIVATE.objPlayer.api.stopTransition(),location.href=value.getAttribute("href"),!1):(playing.lastPlaying&&playing.lastPlaying.parentElement.removeClass("watching"),playing.lastPlaying=value,playing.lastPlaying.parentElement.addClass("watching"),playing.set("id",PRIVATE._getIdVideo(value)),playing.set("caption",{title:value.getAttribute("title"),href:value.getAttribute("href")}),void playing.set("channel",value.querySelector(".zaz-app-terratv__channel")))}),PRIVATE.clickVideo=function(event){if("mob"!=deviceType)return PRIVATE.clickVideo=!0,playing.set("anchor",event.currentTarget),event.preventDefault(),event.stopPropagation(),!1;player.metrics(player.items.indexOf(event.currentTarget))};for(var i=0;i<player.items.length;i++)player.items[i].dataset.position=i+1,player.items[i].addEventListener("click",PRIVATE.clickVideo);return"mob"!=deviceType?pkg.require([PRIVATE.playerAppName],function(AppPlayer){PRIVATE.AppPlayer=AppPlayer,playing.set("anchor",player.items[0]),PUBLIC.trigger("ready",!0)}):(player.target.addEventListener("click",function(){player.metrics(0)}),player.active=0),PRIVATE.totalVideos=data.target.querySelectorAll(".zaz-app-terratv__list__item").length,PUBLIC}},teardown:function(why,__static,__proto,__shared){}})});