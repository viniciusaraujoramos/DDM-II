/*! zaz-rum - v1.0.0 - 07/10/2024 -- 1:40pm */
zaz.use(function rum(pkg){"use strict";pkg.require(["modFactory"],function(modFactory){modFactory.create({name:"rum",version:"1.0.0",state:"ok",docs:"http://github.tpn.terra.com/pages/terra/zaz-mod-rum",source:"http://github.tpn.terra.com/Terra/zaz-mod-rum",description:"Real user monitoring",tests:"http://s1.trrsf.com/fe/zaz-mod-rum/tests/index.htm?zaz[env]=tests",dependencies:[],setup:function(data){var PRIVATE={},MODULE={config:{}};PRIVATE.data=data,PRIVATE.hasPerformance=!1,PRIVATE.hasPerformanceMark=!1,PRIVATE.unloadEventDispatched=!1,PRIVATE.firstHiddenTime="hidden"===document.visibilityState?0:1/0,PRIVATE.webvitalsPromises=[],document.addEventListener("visibilitychange",function(event){PRIVATE.firstHiddenTime=Math.min(PRIVATE.firstHiddenTime,event.timeStamp)},{once:!0}),window.performance&&(PRIVATE.hasPerformance=!0,window.performance.mark&&(PRIVATE.hasPerformanceMark=!0)),PRIVATE.objRUM={documentURL:encodeURIComponent(document.URL),location:null,userAgent:null,navigationType:null,performance:null,renderTableNavigation:-1,renderTableResponse:-1,renderTable:-1,device:pkg.context.platform.get("type"),browser:pkg.context.browser.get("name"),browserVersion:pkg.context.browser.get("version"),webVitals:{},testeAb:window.terraVersion&&"terra360"==window.terraVersion?"terra360":"default",lite:0,prefetch:window.articleIsPrefetch||!1,prerender:document.prerendering,gamThreadYield:window.__gamThreadYield},PRIVATE.objRUM.location=pkg.utils.getCookie("trrgeo"),PRIVATE.hasPerformance&&(window.performance.navigation&&(PRIVATE.objRUM.navigationType=window.performance.navigation.type),PRIVATE.objRUM.performance=window.performance.timing),window.navigator&&window.navigator.userAgent&&(PRIVATE.objRUM.userAgent=window.navigator.userAgent),window.navigator&&window.navigator.deviceMemory&&(PRIVATE.objRUM.deviceMemory=window.navigator.deviceMemory),PRIVATE.registerFirstPaint=function(){var firstPaint,firstPaintTime;window.chrome&&window.chrome.loadTimes?(firstPaint=1e3*window.chrome.loadTimes().firstPaintTime,firstPaintTime=firstPaint-1e3*window.chrome.loadTimes().startLoadTime):"number"==typeof window.performance.timing.msFirstPaint?(firstPaint=window.performance.timing.msFirstPaint,firstPaintTime=firstPaint-window.performance.timing.navigationStart):firstPaintTime=-1,PRIVATE.objRUM.firstPaintTime=firstPaintTime},PRIVATE.registerPaint=function(){if(window.performance&&performance.getEntriesByType){var paint=window.performance.getEntriesByType("paint"),length=0,objFirstPaint={};if(paint){length=paint.length;for(var i=0;i<length;i++)objFirstPaint[paint[i].name]=paint[i].startTime}objFirstPaint["first-paint"]&&(PRIVATE.objRUM.firstPaint=objFirstPaint["first-paint"]),objFirstPaint["first-contentful-paint"]&&(PRIVATE.objRUM.firstContentfulPaint=objFirstPaint["first-contentful-paint"])}},PRIVATE.registerConnectionInfo=function(){if(window.navigator&&window.navigator.connection){var attr=["downlink","downlinkMax","effectiveType","rtt","saveData","type"];PRIVATE.objRUM.connection={};for(var i=0;i<attr.length;i++)attr[i]in window.navigator.connection&&(PRIVATE.objRUM.connection[attr[i]]=window.navigator.connection[attr[i]])}},PRIVATE.registerCustomMarks=function(){if(PRIVATE.hasPerformanceMark&&MODULE.config.hasMark){try{window.performance.measure("resultResponse","responseStart","finishTable"),window.performance.measure("resultNavigation","navigationStart","finishTable"),window.performance.measure("resultRenderTable","startTable","finishTable"),PRIVATE.objRUM.renderTableResponse=window.performance.getEntriesByName("resultResponse")[0].duration,PRIVATE.objRUM.renderTableNavigation=window.performance.getEntriesByName("resultNavigation")[0].duration,PRIVATE.objRUM.renderTable=window.performance.getEntriesByName("resultRenderTable")[0].duration}catch(e){}try{window.performance.measure("ZAZ_CEREBRO_DEFINITION_TO_LOAD","ZAZ_CEREBRO_DEFINED","ZAZ_CEREBRO_LOADED"),window.performance.measure("ZAZ_CEREBRO_LOAD_TO_START","ZAZ_CEREBRO_LOADED","ZAZ_CEREBRO_STARTED"),PRIVATE.objRUM.zazDefinitionToLoad=window.performance.getEntriesByName("ZAZ_CEREBRO_DEFINITION_TO_LOAD")[0].duration,PRIVATE.objRUM.zazLoadToStart=window.performance.getEntriesByName("ZAZ_CEREBRO_LOAD_TO_START")[0].duration}catch(e){}try{window.performance.measure("AD_S0_BIDDING","AD_S0_BIDDING_START","AD_S0_BIDDING_END"),PRIVATE.objRUM.adS0Bidding=window.performance.getEntriesByName("AD_S0_BIDDING")[0].duration}catch(e){PRIVATE.objRUM.adS0Bidding=0}}},PRIVATE.registerCustomMarksAds=function(){var adS0Loaded=!1,adS1Loaded=!1,listenerAds=function(data){if(data&&"dfpIframe"===data.type&&PRIVATE.hasPerformanceMark&&MODULE.config.hasMark){if("ad.s0"===data.sender){adS0Loaded=!0;try{window.performance.measure("AD_S0_DOM_TO_ADMANAGER","AD_S0_START","AD_S0_BEFORE_DFP"),window.performance.measure("AD_S0_ADMANAGER_TO_FINISH","AD_S0_BEFORE_DFP","AD_S0_AFTER_DFP"),window.performance.measure("AD_S0_DOM_TO_FINISH","AD_S0_START","AD_S0_AFTER_DFP"),PRIVATE.objRUM.adS0DomToAdmanager=window.performance.getEntriesByName("AD_S0_DOM_TO_ADMANAGER")[0].duration,PRIVATE.objRUM.adS0AdmanagerToFinish=window.performance.getEntriesByName("AD_S0_ADMANAGER_TO_FINISH")[0].duration,PRIVATE.objRUM.adS0DomToFinish=window.performance.getEntriesByName("AD_S0_DOM_TO_FINISH")[0].duration}catch(e){}}if("ad.s1"===data.sender){adS1Loaded=!0;try{window.performance.measure("AD_S1_DOM_TO_ADMANAGER","AD_S1_START","AD_S1_BEFORE_DFP"),window.performance.measure("AD_S1_ADMANAGER_TO_FINISH","AD_S1_BEFORE_DFP","AD_S1_AFTER_DFP"),window.performance.measure("AD_S1_DOM_TO_FINISH","AD_S1_START","AD_S1_AFTER_DFP"),PRIVATE.objRUM.adS1DomToAdmanager=window.performance.getEntriesByName("AD_S1_DOM_TO_ADMANAGER")[0].duration,PRIVATE.objRUM.adS1AdmanagerToFinish=window.performance.getEntriesByName("AD_S1_ADMANAGER_TO_FINISH")[0].duration,PRIVATE.objRUM.adS1DomToFinish=window.performance.getEntriesByName("AD_S1_DOM_TO_FINISH")[0].duration}catch(e){}}}adS0Loaded&&adS1Loaded&&pkg.context.page.off("rum-ad-loaded",listenerAds)};MODULE.config.hasMark&&pkg.context.page.at("rum-ad-loaded",listenerAds)},PRIVATE.registerLOAF=function(){try{if(PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")){new PerformanceObserver(function(list){list.getEntries().forEach(function(entry){if(entry.scripts.length>0&&entry.duration>150){var payload={documentURL:window.location.href,device:pkg.context.platform.get("type"),browser:pkg.context.browser.get("name"),browserVersion:pkg.context.browser.get("version"),duration:entry.duration,blockingDuration:entry.blockingDuration,scripts:[]};entry.scripts.forEach(function(scr){var objscr={name:scr.name,sourceLocation:scr.sourceLocation,type:scr.type,entryType:scr.entryType,duration:scr.duration};payload.scripts.push(objscr)});var formData=new FormData;formData.append("json",JSON.stringify(payload)),navigator.sendBeacon("https://api-cloud.terra.com.br/rum/INP",formData)}})}).observe({type:"long-animation-frame",buffered:!0})}}catch(e){}},PRIVATE.registerWebVitals=function(){function sendGaMetric(c,a,l,v){window.tga.send("send","event",c,a,l,v)}PRIVATE.webvitalsPromises.push(new Promise(function(resolve,reject){window.webVitals.onCLS(function(obj){console.log("------\x3e",obj),PRIVATE.objRUM.webVitals.cls=parseFloat((1e4*obj.delta).toFixed(3)),sendGaMetric("WebVitals - CLS",obj.rating,obj.attribution.largestShiftTarget,PRIVATE.objRUM.webVitals.cls),resolve()})})),PRIVATE.webvitalsPromises.push(new Promise(function(resolve,reject){window.webVitals.onLCP(function(obj){PRIVATE.objRUM.webVitals.lcp=parseFloat(obj.delta.toFixed(3)),sendGaMetric("WebVitals - LCP",obj.rating,obj.attribution.element,PRIVATE.objRUM.webVitals.lcp),resolve()})})),window.webVitals.onFID(function(obj){PRIVATE.objRUM.webVitals.fid=parseFloat(obj.delta.toFixed(3)),sendGaMetric("WebVitals - FID",obj.rating,obj.attribution.eventTarget,PRIVATE.objRUM.webVitals.fid)}),window.webVitals.onINP(function(obj){PRIVATE.objRUM.webVitals.inp=parseFloat(obj.delta.toFixed(3)),sendGaMetric("WebVitals - INP",obj.rating,obj.attribution.eventTarget,PRIVATE.objRUM.webVitals.inp)})},PRIVATE.sendData=function(){Promise.all(PRIVATE.webvitalsPromises).then(function(){var headers={type:"application/x-www-form-urlencoded; charset=UTF-8"},blob=new Blob(["json="+window.encodeURIComponent(JSON.stringify(PRIVATE.objRUM))],headers);navigator.sendBeacon("https://api-cloud.terra.com.br/rum/portal",blob)})},MODULE.contentDelivery=function(info){PRIVATE.hasPerformanceMark&&MODULE.config.hasMark&&window.performance.mark("finishTable")},MODULE.setPage=function(pageName){PRIVATE.objRUM.page=""!==pageName?pageName:"page"};var templateType=pkg.context.publisher.get("template");return"home"===templateType?(MODULE.setPage("capa"),MODULE.config.hasMark=!0):"content"===templateType&&(MODULE.setPage("noticias"),MODULE.contentDelivery()),navigator.sendBeacon&&JSON&&JSON.stringify&&(PRIVATE.registerFirstPaint(),PRIVATE.registerPaint(),PRIVATE.registerConnectionInfo(),PRIVATE.registerCustomMarks(),PRIVATE.registerCustomMarksAds(),pkg.require(["mod.webVitals"],function(){PRIVATE.registerWebVitals(),PRIVATE.registerLOAF()}),window.addEventListener("beforeunload",PRIVATE.sendData)),MODULE},teardown:function(data){}})})}),zaz.use(function(pkg){"use strict";if(window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.search("Googlebot")>-1)return!1;pkg.require(["mod.rum"],function(Rum){})});